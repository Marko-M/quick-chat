// Quick Chat 4.12 - core
jQuery.fn.quick_chat_insert_at_caret=function(a){return this.each(function(){if(document.selection)this.focus(),sel=document.selection.createRange(),sel.text=a,this.focus();else if(this.selectionStart||"0"==this.selectionStart){var b=this.selectionStart,c=this.selectionEnd,e=this.scrollTop;this.value=this.value.substring(0,b)+a+this.value.substring(c,this.value.length);this.focus();this.selectionStart=b+a.length;this.selectionEnd=b+a.length;this.scrollTop=e}else this.value+=a,this.focus()})};
var quick_chat=jQuery.extend(quick_chat||{},{last_timestamp:0,rooms:[],private_queue:{},private_current:{},private_count:0,audio_support:0,play_audio:0,audio_element:document.createElement("audio"),update_users_limit:Math.floor(quick_chat.inactivity_timeout/quick_chat.timeout_refresh_users),update_users_counter:0,private_queue_name:"quick_chat_private_queue_"+quick_chat.user_id,random_string:function(a){for(var b=0,c="",e;b<a;)e=Math.floor(100*Math.random())%94+33,!(33<=e&&47>=e)&&(!(58<=e&&64>=e)&&
!(91<=e&&96>=e)&&!(123<=e&&126>=e))&&(b++,c+=String.fromCharCode(e));return"quick_chat_"+c},is_user_inactive:function(){return quick_chat.update_users_counter==quick_chat.update_users_limit&&0!=quick_chat.user_status?!0:!1},is_private_eq:function(a,b){return a.private_from==b.private_from&&a.private_to==b.private_to||a.private_to==b.private_from&&a.private_from==b.private_to?!0:!1},spawn_private_chat:function(a,b,c){var e={};e.room_name=a;e.userlist_position="top";e.scroll_enable=1;e.avatars=1;e.him=
b;e.state="o"==c?"o":"m";quick_chat.data[a]=e;b='<div class="quick-chat-container quick-chat-container-private" data-quick-chat-id="'+a+'"><div class="quick-chat-container-private-titlebar"><div class="quick-chat-container-private-title">'+quick_chat.i18n.private_title_s+'</div><div class="quick-chat-container-private-close"><a href="" title="'+quick_chat.i18n.private_close_s+'">x</a></div><div class="quick-chat-container-private-minimize-restore"><a href="" title="';b="o"==c?b+quick_chat.i18n.private_minimize_s:
b+quick_chat.i18n.private_restore_s;b+='">'+("o"==c?"-":"o")+'</a></div></div><div class="quick-chat-users-container quick-chat-users-container-top"></div><div class="quick-chat-history-container" style="height: 300px;"></div>';0==quick_chat.user_status&&(b+='<div class="quick-chat-links"><div class="quick-chat-left-link quick-chat-transcript-link"><a title="'+quick_chat.i18n.fetch_transcript_s+'" href="">'+quick_chat.i18n.transcript_s+"</a></div></div>");b+='<div class="quick-chat-alias-container"><input class="quick-chat-alias" type="text" autocomplete="off" maxlength="20" value="'+
quick_chat.user_name+'" readonly="readonly" /></div><textarea class="quick-chat-message"></textarea></div>';jQuery("body").append(b);a=jQuery('div[data-quick-chat-id="'+a+'"]');quick_chat.private_right_position(a);quick_chat.private_bottom_position(a,c)},private_right_position:function(a){var b=a.outerWidth(!0)*quick_chat.private_count;quick_chat.private_count++;a.css("right",b)},private_bottom_position:function(a,b){"o"==b?jQuery(a).animate({bottom:0},500):"m"==b&&jQuery(a).animate({bottom:-(jQuery(a).outerHeight(!0)-
jQuery(a).find("div.quick-chat-history-container").position().top)},500)},update_private_cookie:function(a,b){jQuery.cookie(a,jQuery.toJSON(b),{path:quick_chat.cookiepath,domain:quick_chat.cookie_domain})},preg_quote:function(a){return a.replace(RegExp("[.*+?|()\\[\\]{}\\\\]","g"),"\\$&")},stripslashes:function(a){a=a.replace(/\\'/g,"'");a=a.replace(/\\"/g,'"');a=a.replace(/\\\\/g,"\\");return a=a.replace(/\\0/g,"\x00")},flag_html:function(a){return null!=a.c&&null!=a.m?' <img class="quick-chat-flags" title="'+
a.m+'" src="'+quick_chat.quick_flag_url+"/"+a.c+'.gif" />':""},update_rooms:function(){quick_chat.rooms=[];for(var a in quick_chat.data)-1==jQuery.inArray(quick_chat.data[a].room_name,quick_chat.rooms)&&quick_chat.rooms.push(quick_chat.data[a].room_name)},update_sound_state:function(){0==quick_chat.play_audio?jQuery("div.quick-chat-sound-link a").css("text-decoration","line-through"):jQuery("div.quick-chat-sound-link a").css("text-decoration","none")},user_status_class:function(a){var b="";0==a?b=
"quick-chat-admin":1==a?b="quick-chat-loggedin":2==a&&(b="quick-chat-guest");return b},is_private_allowed:function(a){return 0==a||1==a&&1==quick_chat.loggedin_initiate_private||2==a&&1==quick_chat.guests_initiate_private?!0:!1},single_message_html:function(a,b,c){if(!1==c)var e=quick_chat.stripslashes(a.alias),d=quick_chat.user_status_class(a.status);else!0==c&&(e=quick_chat.i18n.notice_s,d="quick-chat-notice");var f=quick_chat.stripslashes(a.message),j;for(j in quick_chat.smilies)var g='<div class="quick-chat-smile quick-chat-smile-'+
quick_chat.smilies[j]+'" title="'+j+'"></div>',f=f.replace(RegExp(quick_chat.preg_quote(j),"g"),g);d='<div class="quick-chat-history-message-alias-container '+d+'"><div class="quick-chat-history-header">';1==b&&!1!=a.avatar&&(d+=quick_chat.stripslashes(a.avatar));d+='<div class="quick-chat-history-alias">';d=e==quick_chat.user_name||!0==c||1==quick_chat.no_participation?d+e:d+('<a href="" title="'+quick_chat.i18n.reply_to_s.replace("%s",e)+'">'+e+"</a>");d=d+"</div>"+('<div class="quick-chat-history-timestring">'+
a.timestring+'</div></div><div class="quick-chat-history-message">'+f+"</div>");0==quick_chat.user_status&&(d+='<div class="quick-chat-history-links">');0==quick_chat.user_status&&!1==c&&(d+='<input class="quick-chat-to-delete-boxes" type="checkbox" name="quick-chat-to-delete[]" value="'+a.id+'" />');0==quick_chat.user_status&&(d+="</div>");return d+="</div>"},check_username:function(a,b,c){"undefined"!=typeof quick_chat.data[a].username_timeout&&clearTimeout(quick_chat.data[a].username_timeout);
quick_chat.data[a].username_timeout=setTimeout(function(){jQuery.ajax({type:"POST",url:quick_chat.ajaxurl,data:{action:"quick-chat-ajax-username-check",username_check:b},cache:!1,dataType:"json",success:function(a){0==quick_chat.no_participation&&1==a.no_participation&&location.reload(!0);jQuery(c).html("");if(1==a.username_invalid)jQuery(c).addClass("quick-chat-error"),jQuery(c).html(quick_chat.i18n.username_invalid_s);else if(1==a.username_bad_words)jQuery(c).addClass("quick-chat-error"),jQuery(c).html(quick_chat.i18n.username_bad_words_s);
else if(1==a.username_exists)jQuery(c).addClass("quick-chat-error"),jQuery(c).html(quick_chat.i18n.username_exists_s);else if(1==a.username_blocked)jQuery(c).addClass("quick-chat-error"),jQuery(c).html(quick_chat.i18n.username_blocked_s);else if(0==a.username_exists||0==a.username_blocked||0==a.username_invalid)jQuery(c).html(""),quick_chat.user_name=a.username,jQuery("input.quick-chat-alias").val(a.username)},beforeSend:function(){jQuery(c).html("");jQuery(c).removeClass("quick-chat-error");jQuery(c).html(quick_chat.i18n.username_check_wait_s)}});
delete quick_chat.data[a].username_timeout},1500)},update_messages:function(){jQuery.post(quick_chat.ajaxurl,{action:"quick-chat-ajax-update-messages",last_timestamp:quick_chat.last_timestamp,rooms:quick_chat.rooms},function(a){(0==quick_chat.no_participation&&1==a.no_participation||1==quick_chat.no_participation&&0==a.no_participation)&&location.reload(!0);if(1==a.success){var b=a.messages;jQuery("div.quick-chat-container").each(function(){for(var a=0,e=jQuery(this).attr("data-quick-chat-id"),d=
quick_chat.data[e].room_name,f=quick_chat.data[e].avatars,j=quick_chat.data[e].scroll_enable,g=jQuery(this).find(".quick-chat-history-container"),e=quick_chat.data[e].state,k=0;"undefined"!=typeof b[k];k++)if(d==b[k].room)if("quick_chat"!=b[k].alias)0==a&&(1==quick_chat.play_audio&&quick_chat.user_name!=quick_chat.stripslashes(b[k].alias)&&0!=quick_chat.last_timestamp)&&(quick_chat.audio_element.play(),a=1),0!=quick_chat.last_timestamp&&("undefined"!=typeof e&&"m"==e)&&jQuery(this).find("div.quick-chat-container-private-minimize-restore a").click(),
jQuery(g).append(quick_chat.single_message_html(b[k],f,!1));else if(0!=quick_chat.last_timestamp){var l=jQuery.parseJSON(quick_chat.stripslashes(b[k].message)),h;for(h in l)if(l[h].private_to==quick_chat.user_name&&"INV"==l[h].type){if(quick_chat.is_private_allowed(b[k].status)){quick_chat.private_queue[h]=l[h];quick_chat.update_private_cookie(quick_chat.private_queue_name,quick_chat.private_queue);var m=jQuery.extend(!0,{},b[k]);m.message=quick_chat.i18n.invitation_received_s.replace("%s",l[h].private_from);
jQuery(g).append(quick_chat.single_message_html(m,0,!0))}}else if(l[h].private_from==quick_chat.user_name){var m=!1,n;for(n in quick_chat.private_queue)quick_chat.is_private_eq(quick_chat.private_queue[n],l[h])&&(quick_chat.spawn_private_chat(n,l[h].private_to,"o"),quick_chat.update_rooms(),delete quick_chat.private_queue[n],quick_chat.update_private_cookie(quick_chat.private_queue_name,quick_chat.private_queue),quick_chat.private_current[n]=quick_chat.data[n],quick_chat.update_private_cookie(quick_chat.private_current_name,
quick_chat.private_current),m=!0);!1==m&&(quick_chat.is_private_allowed(b[k].status)?(quick_chat.spawn_private_chat(h,l[h].private_to,"o"),quick_chat.update_rooms(),quick_chat.private_current[h]=quick_chat.data[h],quick_chat.update_private_cookie(quick_chat.private_current_name,quick_chat.private_current),m=jQuery.extend(!0,{},b[k]),m.message=quick_chat.i18n.invitation_sent_s.replace("%s",l[h].private_to),jQuery(g).append(quick_chat.single_message_html(m,0,!0))):alert(quick_chat.i18n.not_allowed_to_initiate_s))}}1==
j&&jQuery(g).animate({scrollTop:jQuery(g)[0].scrollHeight},500)});quick_chat.last_timestamp=b[b.length-1].unix_timestamp}quick_chat.is_user_inactive()||quick_chat.update_messages()},"json")},update_users:function(){quick_chat.update_users_counter++;quick_chat.is_user_inactive()?(clearInterval(quick_chat.users_interval),jQuery("div.quick-chat-container").html('<div style="quick-chat-bootom-notice">'+quick_chat.i18n.dropped_inactivity_s+"</div>")):jQuery.post(quick_chat.ajaxurl,{action:"quick-chat-ajax-update-users",
rooms:quick_chat.rooms},function(a){(0==quick_chat.no_participation&&1==a.no_participation||1==quick_chat.no_participation&&0==a.no_participation)&&location.reload(!0);"undefined"==typeof quick_chat.users_interval&&(quick_chat.users_interval=setInterval(function(){quick_chat.update_users()},1E3*quick_chat.timeout_refresh_users));var b=a.users;jQuery("div.quick-chat-container").each(function(){for(var a=jQuery(this).attr("data-quick-chat-id"),e=quick_chat.data[a].userlist_position,a=quick_chat.data[a].room_name,
d="",f=0;"undefined"!=typeof b[f];f++)if(a==b[f].room){if(0==quick_chat.user_status){var j=[];jQuery(this).find(".quick-chat-users-container input[type=checkbox]:checked").each(function(){j.push(jQuery(this).attr("data-user-id"))})}var g=quick_chat.stripslashes(b[f].alias),d=d+('<div class="quick-chat-single-user '+quick_chat.user_status_class(b[f].status)+'">');g==quick_chat.user_name||1==quick_chat.no_participation?d+=g:(0==quick_chat.user_status&&(d+='<input class="quick-chat-to-ban-boxes" type="checkbox" name="quick-chat-to-ban[]" value="'+
b[f].ip+'" data-user-id="'+b[f].id+'"'+(0==jQuery.inArray(b[f].id,j)?' checked="checked"':"")+"/>"),d+='<a href="" title="'+quick_chat.i18n.private_with_s.replace("%s",g)+'">'+g+"</a>");d+=quick_chat.flag_html(b[f]);d+="</div>";"top"==e&&(d+=", ")}jQuery(this).find(".quick-chat-users-container").html("top"==e?d.substring(0,d.length-2):d)})},"json")},new_message:function(a,b,c){a=quick_chat.data[a].room_name;quick_chat.update_users_counter=0;jQuery.post(quick_chat.ajaxurl,{action:"quick-chat-ajax-new-message",
sys_mes:c,message:b,room:a},function(a){0==quick_chat.no_participation&&1==a.no_participation&&location.reload(!0)})}});
quick_chat.audio_element.canPlayType&&(quick_chat.audio_element.canPlayType('audio/ogg; codecs="vorbis"')?(quick_chat.audio_element.setAttribute("src",quick_chat.url+"/sounds/message-sound.ogg"),quick_chat.audio_element.setAttribute("preload","auto"),quick_chat.audio_support=1):quick_chat.audio_element.canPlayType("audio/mpeg;")?(quick_chat.audio_element.setAttribute("src",quick_chat.url+"sounds/message-sound.mp3"),quick_chat.audio_element.setAttribute("preload","auto"),quick_chat.audio_support=1):
quick_chat.audio_element.canPlayType('audio/wav; codecs="1"')&&(quick_chat.audio_element.setAttribute("src",quick_chat.url+"sounds/message-sound.wav"),quick_chat.audio_element.setAttribute("preload","auto"),quick_chat.audio_support=1));1==quick_chat.audio_support&&(quick_chat.play_audio=jQuery.cookie("quick_chat_sound_state")?jQuery.cookie("quick_chat_sound_state"):quick_chat.audio_enable);
if(0==quick_chat.no_participation){null!=jQuery.cookie(quick_chat.private_queue_name)&&(quick_chat.private_queue=jQuery.parseJSON(jQuery.cookie(quick_chat.private_queue_name)));null!=jQuery.cookie(quick_chat.private_current_name)&&(quick_chat.private_current=jQuery.parseJSON(jQuery.cookie(quick_chat.private_current_name)));for(var quick_chat_pc_room_name in quick_chat.private_current)quick_chat.spawn_private_chat(quick_chat_pc_room_name,quick_chat.private_current[quick_chat_pc_room_name].him,quick_chat.private_current[quick_chat_pc_room_name].state)}quick_chat.update_rooms();
quick_chat.audio_support&&(jQuery("div.quick-chat-sound-link").css("display","block"),quick_chat.update_sound_state());quick_chat.update_users();jQuery("textarea.quick-chat-message").live("keypress",function(a){code=a.keyCode?a.keyCode:a.which;if(13==code.toString()&&(a.preventDefault(),a=jQuery.trim(jQuery(this).val()),""!=a)){var b=jQuery(this).parents(".quick-chat-container").attr("data-quick-chat-id");jQuery(this).val("");quick_chat.new_message(b,a,!1)}});
jQuery("input.quick-chat-send-button").bind("click",function(a){a.preventDefault();a=jQuery(this).siblings("textarea.quick-chat-message");var b=jQuery.trim(jQuery(a).val());if(""!=b){var c=jQuery(this).parents(".quick-chat-container").attr("data-quick-chat-id");jQuery(a).val("");quick_chat.new_message(c,b,!1)}jQuery(this).prev().focus()});
jQuery("div.quick-chat-smile").bind("click",function(){var a=jQuery(this).parents(".quick-chat-container").find(".quick-chat-message"),b=jQuery(this);jQuery(this).fadeTo(100,0,function(){jQuery(a).quick_chat_insert_at_caret(jQuery(b).attr("title")).trigger("change");jQuery(b).fadeTo(100,1)})});
jQuery("div.quick-chat-history-alias a").live("click",function(a){a.preventDefault();var b=jQuery(this).parents(".quick-chat-container").find(".quick-chat-message"),c=jQuery(this);jQuery(this).fadeTo(100,0,function(){jQuery(b).quick_chat_insert_at_caret("@"+jQuery(c).text()+": ");jQuery(c).fadeTo(100,1)})});
jQuery("div.quick-chat-single-user a").live("click",function(a){a.preventDefault();var b=jQuery(this).parents(".quick-chat-container").attr("data-quick-chat-id"),c=jQuery(this);jQuery(this).fadeTo(100,0,function(){var a=quick_chat.random_string(12),d=jQuery.parseJSON('{"'+a+'":{"private_from":"'+quick_chat.user_name+'","private_to":"'+jQuery(c).text()+'"}}'),f="INV",j=quick_chat.i18n.private_invite_confirm_s.replace("%s",jQuery(c).text()),g;for(g in quick_chat.private_queue){quick_chat.is_private_eq(quick_chat.private_queue[g],
d[a])&&(f="ACK");j=quick_chat.i18n.private_accept_confirm_s.replace("%s",jQuery(c).text());break}confirm(j)&&(d[a].type=f,quick_chat.new_message(b,jQuery.toJSON(d),!0));jQuery(c).fadeTo(100,1)})});
jQuery("div.quick-chat-container-private-close a").live("click",function(a){a.preventDefault();var b=jQuery(this),c=jQuery(this).parents(".quick-chat-container").attr("data-quick-chat-id");jQuery(this).fadeTo(100,0,function(){delete quick_chat.data[c];delete quick_chat.private_current[c];quick_chat.update_private_cookie(quick_chat.private_current_name,quick_chat.private_current);quick_chat.private_count--;quick_chat.update_rooms();jQuery(this).parents(".quick-chat-container").remove();jQuery(b).fadeTo(100,
1)})});
jQuery("div.quick-chat-container-private-minimize-restore a").live("click",function(a){a.preventDefault();var b=jQuery(this).parents(".quick-chat-container").attr("data-quick-chat-id"),c=jQuery(this).parents(".quick-chat-container"),e=quick_chat.data[b].state,d=jQuery(this);jQuery(this).fadeTo(100,0,function(){"o"==e?(jQuery(d).attr("title",quick_chat.private_restore),quick_chat.data[b].state="m",quick_chat.private_current[b].state="m",quick_chat.update_private_cookie(quick_chat.private_current_name,quick_chat.private_current),
jQuery(d).text("o"),quick_chat.private_bottom_position(c,"m")):"m"==e&&(jQuery(d).attr("title",quick_chat.private_minimize),quick_chat.data[b].state="o",quick_chat.private_current[b].state="o",quick_chat.update_private_cookie(quick_chat.private_current_name,quick_chat.private_current),jQuery(d).text("-"),quick_chat.private_bottom_position(c,"o"));jQuery(d).fadeTo(100,1)})});
jQuery("div.quick-chat-sound-link a").bind("click",function(a){a.preventDefault();var b=jQuery(this);jQuery(this).fadeTo(100,0,function(){quick_chat.play_audio=1==quick_chat.play_audio?0:1;jQuery.cookie("quick_chat_sound_state",quick_chat.play_audio,{path:quick_chat.cookiepath,domain:quick_chat.cookie_domain});quick_chat.update_sound_state();jQuery(b).fadeTo(100,1)})});
jQuery("div.quick-chat-scroll-link a").bind("click",function(a){a.preventDefault();var b=jQuery(this).parents(".quick-chat-container").attr("data-quick-chat-id"),c=quick_chat.data[b].scroll_enable,e=jQuery(this);jQuery(this).fadeTo(100,0,function(){0==c?(quick_chat.data[b].scroll_enable=1,jQuery(e).css("text-decoration","none")):(quick_chat.data[b].scroll_enable=0,jQuery(e).css("text-decoration","line-through"));jQuery(e).fadeTo(100,1)})});
(0==quick_chat.user_status||1==quick_chat.allow_change_username)&&jQuery("input.quick-chat-alias").bind("keyup","change",function(){var a=jQuery.trim(jQuery(this).val());if(""!=a){var b=jQuery(this).parents(".quick-chat-container").attr("data-quick-chat-id"),c=jQuery(this).parents(".quick-chat-container").find("span.quick-chat-username-status");quick_chat.check_username(b,a,c)}});
0!=quick_chat.user_status&&jQuery("textarea.quick-chat-message").bind("keyup change input paste",function(){if(1==jQuery(this).parents(".quick-chat-container").attr("data-quick-chat-counter")){var a=jQuery(this).parents(".quick-chat-container").find("span.quick-chat-counter"),b=jQuery(this).val().length,b=quick_chat.message_maximum_number_chars-b;25>=b&&0<=b?jQuery(a).addClass("quick-chat-warning"):jQuery(a).removeClass("quick-chat-warning");0>b?jQuery(a).addClass("quick-chat-exceeded"):jQuery(a).removeClass("quick-chat-exceeded");
jQuery(a).html(b)}});quick_chat.update_messages();